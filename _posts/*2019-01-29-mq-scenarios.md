---
layout: post
title: 消息中间件应用场景
date: 2019-01-29 17:35:00 +0800
tags: [消息队列]
---

**消息中间件的主要应用场景**：

- 系统解耦
- 异步调用
- 流量削峰


### 系统解耦

![耦合系统](https://user-gold-cdn.xitu.io/2018/12/12/167a2dd9aa01a871?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

直接采用系统调用的方式，系统耦合度太严重。

![](https://user-gold-cdn.xitu.io/2018/12/12/167a2ddb6147076f?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

采用MQ中间件来实现系统解耦，系统A就把自己的一份核心数据发到MQ里，下游哪个系统感兴趣自己去消费即可，不需要了就取消数据的消费。

### 异步调用

![](https://user-gold-cdn.xitu.io/2018/12/12/167a2dde00e660d9?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

将耗时的业务进行异步化处理，让前端用户能够快速获得响应，让用户体验更好。

### 流量削峰

假设你有一个系统，平时正常的时候每秒可能就几百个请求，系统部署在8核16G的机器的上，正常处理都是ok的，每秒几百请求是可以轻松抗住的。但是，在高峰期一下子来了每秒钟几千请求，瞬时出现了流量高峰，此时你的选择是要搞10台机器，抗住每秒几千请求的瞬时高峰吗？

那如果瞬时高峰每天就那么半个小时，接着直接就降低为了每秒就几百请求，如果你线上部署了很多台机器，那么每台机器就处理每秒几十个请求就可以了，这不是有点浪费机器资源吗？但是如果你就部署一台机器，那会导致瞬时高峰时，一下子压垮你的系统，因为绝对无法抗住每秒几千的请求高峰。

**此时我们就可以用MQ中间件来进行流量削峰**。所有机器前面部署一层MQ，平时每秒几百请求大家都可以轻松接收消息。一旦到了瞬时高峰期，一下涌入每秒几千的请求，就可以积压在MQ里面，然后那一台机器慢慢的处理和消费。等高峰期过了，再消费一段时间，MQ里积压的数据就消费完毕了。

![](https://user-gold-cdn.xitu.io/2018/12/12/167a2de1ce147ab1?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

这个就是很典型的一个MQ的用法，用有限的机器资源承载高并发请求，如果业务场景允许**异步削峰**，高峰期积压一些请求在MQ里，然后高峰期过了，后台系统在一定时间内消费完毕不再积压的话，那就很适合用这种技术方案。


### 参考资料

[Java进阶面试系列之一：哥们，你们的系统架构中为什么要引入消息中间件？](https://juejin.im/post/5c0fbaf8f265da616f6fd0c3)

[MQ如何快速实现流量削峰填谷](https://blog.csdn.net/u011676417/article/details/70168194)


